{
    "sourceFile": "admin/perusahaan_admin.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1721779973385,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1721779973385,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\nif (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'admin') {\r\n    header('Location: ../auth/login.php');\r\n    exit;\r\n}\r\n\r\ninclude '../includes/db.php';\r\n\r\nfunction fetchJobs($pdo, $search = '') {\r\n    try {\r\n        $sql = \"SELECT * FROM lowongan_kerja\";\r\n        if (!empty($search)) {\r\n            $search = '%' . $search . '%';\r\n            $sql .= \" WHERE nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search\";\r\n            $stmt = $pdo->prepare($sql);\r\n            $stmt->execute(['search' => $search]);\r\n        } else {\r\n            $stmt = $pdo->query($sql);\r\n        }\r\n        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n        return $jobs;\r\n    } catch (PDOException $e) {\r\n        error_log(\"Error: \" . $e->getMessage());\r\n        return false;\r\n    }\r\n}\r\n\r\n$search = isset($_POST['search']) ? $_POST['search'] : '';\r\n$jobs = fetchJobs($pdo, $search);\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Lowongan Kerja</title>\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/fontawesome-free/css/all.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.dark.min.css\" media=\"screen\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.light.min.css\" media=\"screen\">\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700\" rel=\"stylesheet\">\r\n    <style>\r\n    .nav-sidebar .nav-link.active {\r\n        background-color: #343a40 !important;\r\n    }\r\n\r\n    .content-wrapper {\r\n        padding: 20px !important;\r\n    }\r\n\r\n    .content-header {\r\n        padding: 20px 0 !important;\r\n    }\r\n\r\n    .card {\r\n        transition: transform 0.2s;\r\n        margin-bottom: 20px;\r\n        height: 100%;\r\n        /* Ensure each card takes full height */\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n\r\n    .card:hover {\r\n        transform: scale(1.05);\r\n    }\r\n\r\n    .search-bar {\r\n        margin-bottom: 20px;\r\n    }\r\n\r\n    .card-body {\r\n        flex-grow: 1;\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n\r\n    .card-text {\r\n        flex-grow: 1;\r\n    }\r\n\r\n    .read-more {\r\n        margin-top: auto;\r\n    }\r\n\r\n    .read-more-content {\r\n        display: none;\r\n    }\r\n    </style>\r\n\r\n</head>\r\n\r\n<body class=\"hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed\">\r\n    <div class=\"wrapper\">\r\n        <?php include 'navbar_admin.php'; ?>\r\n\r\n        <div class=\"content-wrapper\">\r\n            <div class=\"content-header\">\r\n                <div class=\"container-fluid\">\r\n                    <div class=\"row mb-2\">\r\n                        <div class=\"col-sm-6\">\r\n                            <h1 class=\"m-0\">Daftar Lowongan Kerja</h1>\r\n                        </div>\r\n                        <div class=\"col-sm-6\">\r\n                            <ol class=\"breadcrumb float-sm-right\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"#\">Home</a></li>\r\n                                <li class=\"breadcrumb-item active\">Lowongan Kerja</li>\r\n                            </ol>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <section class=\"content\">\r\n                <div class=\"container-fluid\">\r\n                    <div class=\"row search-bar\">\r\n                        <div class=\"col-md-12\">\r\n                            <form method=\"POST\" action=\"perusahaan_admin.php\">\r\n                                <div class=\"input-group\">\r\n                                    <input type=\"text\" class=\"form-control\" name=\"search\" placeholder=\"Search\"\r\n                                        value=\"<?php echo htmlspecialchars($search); ?>\">\r\n                                    <div class=\"input-group-append\">\r\n                                        <button class=\"btn btn-primary\" type=\"submit\"><i\r\n                                                class=\"fas fa-search\"></i></button>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row\">\r\n                        <?php if ($jobs): ?>\r\n                        <?php foreach ($jobs as $row): ?>\r\n                        <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n                            <div class=\"card\">\r\n                                <div class=\"card-body\">\r\n                                    <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n                                    <p class=\"card-text\"><strong>Posisi:</strong>\r\n                                        <?php echo htmlspecialchars($row['posisi']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Kualifikasi:</strong>\r\n                                        <?php echo htmlspecialchars($row['kualifikasi']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Prodi:</strong>\r\n                                        <?php\r\n                                            $prodi = json_decode($row['prodi'], true);\r\n                                            if (is_array($prodi)) {\r\n                                                $prodi_list = array_map(function($item) {\r\n                                                    return $item['value'];\r\n                                                }, $prodi);\r\n                                                echo htmlspecialchars(implode(', ', $prodi_list));\r\n                                            } else {\r\n                                                echo htmlspecialchars($row['prodi']);\r\n                                            }\r\n                                            ?>\r\n                                    </p>\r\n                                    <p class=\"card-text\"><strong>Keahlian:</strong>\r\n                                        <?php\r\n                                            $keahlian = json_decode($row['keahlian'], true);\r\n                                            if (is_array($keahlian)) {\r\n                                                $keahlian_list = array_map(function($item) {\r\n                                                    return $item['value'];\r\n                                                }, $keahlian);\r\n                                                echo htmlspecialchars(implode(', ', $keahlian_list));\r\n                                            } else {\r\n                                                echo htmlspecialchars($row['keahlian']);\r\n                                            }\r\n                                            ?>\r\n                                    </p>\r\n                                    <p class=\"card-text\"><strong>Tanggal Posting:</strong>\r\n                                        <?php echo htmlspecialchars($row['tanggal_posting']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Batas Waktu:</strong>\r\n                                        <?php echo htmlspecialchars($row['batas_waktu']); ?></p>\r\n                                    <button class='btn btn-primary btn-sm read-more'\r\n                                        onclick=\"toggleReadMore(this)\">Selengkapnya</button>\r\n                                    <button class='btn btn-secondary btn-sm'\r\n                                        onclick=\"fetchCompanyDetails(<?php echo $row['perusahaan_id']; ?>)\">Detail\r\n                                        Perusahaan</button>\r\n                                    <div class=\"read-more-content\">\r\n                                        <p class=\"card-text\"><strong>Kualifikasi Lengkap:</strong>\r\n                                            <?php echo htmlspecialchars($row['kualifikasi']); ?></p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <?php endforeach; ?>\r\n                        <?php else: ?>\r\n                        <p>Tidak ada data</p>\r\n                        <?php endif; ?>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n        </div>\r\n\r\n        <!-- Modal for company details -->\r\n        <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" role=\"dialog\"\r\n            aria-labelledby=\"modalDetailPerusahaanLabel\" aria-hidden=\"true\">\r\n            <div class=\"modal-dialog\" role=\"document\">\r\n                <div class=\"modal-content\">\r\n                    <div class=\"modal-header\">\r\n                        <h5 class=\"modal-title\" id=\"modalDetailPerusahaanLabel\">Detail Perusahaan</h5>\r\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                        </button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <!-- Company details will be populated here -->\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Tutup</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"../app/plugins/jquery/jquery.min.js\"></script>\r\n    <script src=\"../app/plugins/bootstrap/js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n    <script>\r\n    function fetchCompanyDetails(perusahaanId) {\r\n        $.ajax({\r\n            url: 'get_perusahaan_detail.php',\r\n            method: 'GET',\r\n            data: {\r\n                user_id: perusahaanId\r\n            },\r\n            dataType: 'json',\r\n            success: function(data) {\r\n                if (data.error) {\r\n                    alert(data.error);\r\n                } else {\r\n                    var modalBody = `\r\n                        <p><strong>Nama Perusahaan:</strong> ${data.nama_perusahaan}</p>\r\n                        <p><strong>Jenis Perusahaan:</strong> ${data.nama_jenis}</p>\r\n                        <p><strong>Alamat:</strong> ${data.alamat_perusahaan}</p>\r\n                        <p><strong>Email:</strong> ${data.email_perusahaan}</p>\r\n                        <p><strong>Tahun Didirikan:</strong> ${data.tahun_didirikan}</p>\r\n                        <p><strong>Pimpinan Perusahaan:</strong> ${data.pimpinan_perusahaan}</p>\r\n                        <p><strong>Deskripsi:</strong> ${data.deskripsi_perusahaan}</p>\r\n                        <p><strong>No Telp:</strong> ${data.no_telp}</p>\r\n                        <p><strong>Profile Image:</strong><br><img src=\"${data.profile_image}\" alt=\"Profile Image\" style=\"max-width:100%;height:auto;\"></p>\r\n                    `;\r\n                    $('#modalDetailPerusahaan .modal-body').html(modalBody);\r\n                    $('#modalDetailPerusahaan').modal('show');\r\n                }\r\n            },\r\n            error: function() {\r\n                alert('Gagal mengambil detail perusahaan');\r\n            }\r\n        });\r\n    }\r\n\r\n    function toggleReadMore(button) {\r\n        var content = button.nextElementSibling;\r\n        if (content.style.display === 'none' || content.style.display === '') {\r\n            content.style.display = 'block';\r\n            button.innerText = 'Lebih sedikit';\r\n        } else {\r\n            content.style.display = 'none';\r\n            button.innerText = 'Selengkapnya';\r\n        }\r\n    }\r\n    </script>\r\n</body>\r\n\r\n</html>"
        }
    ]
}