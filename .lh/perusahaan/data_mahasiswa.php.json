{
    "sourceFile": "perusahaan/data_mahasiswa.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1721787851282,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1721787860998,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,10 @@\n     exit;\r\n }\r\n \r\n // Fungsi untuk mengambil semua data lamaran mahasiswa beserta data mahasiswa\r\n-function fetchLamaranMahasiswas($pdo) {\r\n+function fetchLamaranMahasiswas($pdo)\r\n+{\r\n     try {\r\n         $sql = \"\r\n             SELECT lm.id AS lamaran_id, lm.lowongan_id, lm.pesan, lm.status AS status_lamaran, m.id AS mahasiswa_id, m.nama_mahasiswa, m.nim, m.jurusan_id, m.jk, m.alamat, m.no_telp, m.tahun_masuk, m.status AS status_mahasiswa, m.email, m.keahlian, lm.salary, l.nama_pekerjaan\r\n             FROM lamaran_mahasiswas lm\r\n"
                }
            ],
            "date": 1721787851282,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\ninclude '../includes/db.php';\r\n\r\nif (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'perusahaan') {\r\n    header('Location: ../auth/login.php');\r\n    exit;\r\n}\r\n\r\n// Fungsi untuk mengambil semua data lamaran mahasiswa beserta data mahasiswa\r\nfunction fetchLamaranMahasiswas($pdo) {\r\n    try {\r\n        $sql = \"\r\n            SELECT lm.id AS lamaran_id, lm.lowongan_id, lm.pesan, lm.status AS status_lamaran, m.id AS mahasiswa_id, m.nama_mahasiswa, m.nim, m.jurusan_id, m.jk, m.alamat, m.no_telp, m.tahun_masuk, m.status AS status_mahasiswa, m.email, m.keahlian, lm.salary, l.nama_pekerjaan\r\n            FROM lamaran_mahasiswas lm\r\n            JOIN mahasiswas m ON lm.mahasiswa_id = m.id\r\n            JOIN lowongan_kerja l ON lm.lowongan_id = l.id\r\n        \";\r\n        $stmt = $pdo->query($sql);\r\n        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    } catch (PDOException $e) {\r\n        echo \"Error fetching lamaran mahasiswas: \" . $e->getMessage();\r\n        return false;\r\n    }\r\n}\r\n\r\n// Mengambil semua data lamaran mahasiswa beserta data mahasiswa\r\n$lamaranMahasiswas = fetchLamaranMahasiswas($pdo);\r\n\r\n// Memproses form input salary\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['lamaran_id'], $_POST['salary'])) {\r\n    $lamaran_id = $_POST['lamaran_id'];\r\n    $salary = $_POST['salary'];\r\n\r\n    try {\r\n        $sql = \"UPDATE lamaran_mahasiswas SET salary = :salary WHERE id = :lamaran_id\";\r\n        $stmt = $pdo->prepare($sql);\r\n        $stmt->execute(['salary' => $salary, 'lamaran_id' => $lamaran_id]);\r\n        header('Location: ' . $_SERVER['PHP_SELF']);\r\n        exit;\r\n    } catch (PDOException $e) {\r\n        echo \"Error updating salary: \" . $e->getMessage();\r\n    }\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Daftar Lamaran Mahasiswa</title>\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/fontawesome-free/css/all.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/datatables-responsive/css/responsive.bootstrap4.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/datatables-buttons/css/buttons.bootstrap4.min.css\">\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700\" rel=\"stylesheet\">\r\n    <style>\r\n    .nav-sidebar .nav-link.active {\r\n        background-color: #343a40 !important;\r\n    }\r\n\r\n    .content-wrapper {\r\n        margin-top: 20px;\r\n    }\r\n\r\n    .table-responsive {\r\n        overflow-y: auto;\r\n        max-height: 400px;\r\n    }\r\n\r\n    .table-responsive thead {\r\n        position: sticky;\r\n        top: 0;\r\n        z-index: 1;\r\n        background-color: #343a40;\r\n    }\r\n\r\n    .table-responsive thead th {\r\n        color: #ffffff;\r\n        border-color: #454d55;\r\n    }\r\n\r\n    .table-responsive tbody tr:hover {\r\n        background-color: #f2f2f2;\r\n    }\r\n\r\n    .status-label {\r\n        padding: 5px 10px;\r\n        border-radius: 5px;\r\n        color: white;\r\n        display: inline-block;\r\n    }\r\n\r\n    .status-terima {\r\n        background-color: #ffc107;\r\n    }\r\n\r\n    .status-ditolak {\r\n        background-color: #dc3545;\r\n    }\r\n\r\n    .status-pending {\r\n        background-color: #28a745;\r\n        color: black;\r\n    }\r\n\r\n    .modal-content .form-group {\r\n        margin-bottom: 1rem;\r\n    }\r\n\r\n    .modal-content .form-control {\r\n        width: 100%;\r\n        padding: .375rem .75rem;\r\n        font-size: 1rem;\r\n        line-height: 1.5;\r\n        color: #495057;\r\n        background-color: #fff;\r\n        background-clip: padding-box;\r\n        border: 1px solid #ced4da;\r\n        border-radius: .25rem;\r\n        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;\r\n    }\r\n    </style>\r\n</head>\r\n\r\n<body class=\"hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed\">\r\n    <div class=\"wrapper\">\r\n        <?php include 'navbar_perusahaan.php'; ?>\r\n\r\n        <div class=\"content-wrapper\">\r\n            <div class=\"content-header\">\r\n                <div class=\"container-fluid\">\r\n                    <!-- Success and error messages -->\r\n                </div>\r\n            </div>\r\n\r\n            <section class=\"content\">\r\n                <div class=\"container-fluid\">\r\n                    <div class=\"card\">\r\n                        <div class=\"card-header\">\r\n                            <h3 class=\"card-title\"><i class=\"fas fa-list\"></i> Daftar Lamaran Mahasiswa</h3>\r\n                            <div class=\"card-tools\">\r\n                                <select id=\"statusFilter\" class=\"form-control\">\r\n                                    <option value=\"\">Semua Status</option>\r\n                                    <option value=\"Diterima\">Diterima</option>\r\n                                    <option value=\"Ditolak\">Ditolak</option>\r\n                                    <option value=\"Pending\">Pending</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"card-body\">\r\n                            <div class=\"table-responsive\">\r\n                                <table id=\"mahasiswaTable\" class=\"table table-bordered table-striped\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>No</th>\r\n                                            <th>Nama Mahasiswa</th>\r\n                                            <th>NIM</th>\r\n                                            <th>Jenis Kelamin</th>\r\n                                            <th>No Telepon</th>\r\n                                            <th>Email</th>\r\n                                            <th>Keahlian</th>\r\n                                            <th>Nama Lowongan</th>\r\n                                            <th>Status Lamaran</th>\r\n                                            <th>Pesan</th>\r\n                                            <th>Salary</th>\r\n                                            <th>Aksi</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <?php\r\n    if ($lamaranMahasiswas) {\r\n        $no = 1;\r\n        foreach ($lamaranMahasiswas as $row) {\r\n            $statusClass = strtolower($row['status_lamaran']) == 'diterima' ? 'status-terima' : (strtolower($row['status_lamaran']) == 'ditolak' ? 'status-ditolak' : 'status-pending');\r\n            echo \"<tr>\";\r\n            echo \"<td>\" . $no . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['nama_mahasiswa']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['nim']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['jk']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['no_telp']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['email']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['keahlian']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['nama_pekerjaan']) . \"</td>\";\r\n            echo \"<td><span class='status-label {$statusClass}'>\" . htmlspecialchars($row['status_lamaran']) . \"</span></td>\";\r\n            echo \"<td>\" . htmlspecialchars($row['pesan']) . \"</td>\";\r\n            echo \"<td>\";\r\n            if (strtolower($row['status_lamaran']) == 'diterima') {\r\n                if (isset($row['salary']) && $row['salary'] !== null) {\r\n                    echo \"Rp. \" . number_format($row['salary'], 2, ',', '.');\r\n                } else {\r\n                    echo \"<button class='btn btn-primary btn-sm' onclick='showSalaryModal(\" . $row['lamaran_id'] . \")'>Masukkan Salary</button>\";\r\n                }\r\n            } else {\r\n                echo \"N/A\";\r\n            }\r\n            echo \"</td>\";\r\n            echo \"<td><button class='btn btn-info btn-sm' onclick=\\\"window.location.href='lihat_pelamar.php?lowongan_id=\" . $row['lowongan_id'] . \"&mahasiswa_id=\" . $row['mahasiswa_id'] . \"'\\\">Lihat Portofolio</button></td>\";\r\n            echo \"</tr>\";\r\n            $no++;\r\n        }\r\n    } else {\r\n        echo \"<tr><td colspan='12'>Tidak ada data</td></tr>\";\r\n    }\r\n    ?>\r\n                                    </tbody>\r\n\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Salary Modal -->\r\n    <div class=\"modal fade\" id=\"salaryModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"salaryModalLabel\"\r\n        aria-hidden=\"true\">\r\n        <div class=\"modal-dialog\" role=\"document\">\r\n            <div class=\"modal-content\">\r\n                <form method=\"post\" action=\"\">\r\n                    <div class=\"modal-header\">\r\n                        <h5 class=\"modal-title\" id=\"salaryModalLabel\">Masukkan Salary</h5>\r\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                        </button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <input type=\"hidden\" name=\"lamaran_id\" id=\"lamaran_id\">\r\n                        <div class=\"form-group\">\r\n                            <label for=\"salary\">Salary</label>\r\n                            <input type=\"number\" class=\"form-control\" name=\"salary\" id=\"salary\" required>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Simpan</button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"></script>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js\"></script>\r\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/@yaireo/tagify@4.9.7/dist/tagify.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n    <script src=\"../app/plugins/fontawesome-free/js/all.min.js\"></script>\r\n    <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables/jquery.dataTables.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-responsive/js/dataTables.responsive.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-responsive/js/responsive.bootstrap4.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-buttons/js/dataTables.buttons.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-buttons/js/buttons.bootstrap4.min.js\"></script>\r\n    <script src=\"../app/plugins/jszip/jszip.min.js\"></script>\r\n    <script src=\"../app/plugins/pdfmake/pdfmake.min.js\"></script>\r\n    <script src=\"../app/plugins/pdfmake/vfs_fonts.js\"></script>\r\n    <script src=\"../app/plugins/datatables-buttons/js/buttons.html5.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-buttons/js/buttons.print.min.js\"></script>\r\n    <script src=\"../app/plugins/datatables-buttons/js/buttons.colVis.min.js\"></script>\r\n    <script>\r\n    function showSalaryModal(lamaran_id) {\r\n        $('#lamaran_id').val(lamaran_id);\r\n        $('#salaryModal').modal('show');\r\n    }\r\n\r\n    $(document).ready(function() {\r\n        var table = $('#mahasiswaTable').DataTable();\r\n\r\n        $('#statusFilter').on('change', function() {\r\n            var status = $(this).val();\r\n            if (status) {\r\n                table.column(8).search(status).draw();\r\n            } else {\r\n                table.column(8).search('').draw();\r\n            }\r\n        });\r\n    });\r\n    </script>\r\n</body>\r\n\r\n</html>"
        }
    ]
}