{
    "sourceFile": "cdc/index.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1721777302117,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1721777371357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,20 @@\n         return false;\r\n     }\r\n }\r\n \r\n+function fetchCDCData($pdo, $user_id) {\r\n+    try {\r\n+        $sql = \"SELECT * FROM admins WHERE user_id = :user_id\";\r\n+        $stmt = $pdo->prepare($sql);\r\n+        $stmt->execute(['user_id' => $user_id]);\r\n+        return $stmt->fetch(PDO::FETCH_ASSOC);\r\n+    } catch (PDOException $e) {\r\n+        echo \"Error fetching admin data: \" . $e->getMessage();\r\n+        return false;\r\n+    }\r\n+}\r\n+\r\n // Fetch data for charts\r\n function fetchChartData($pdo) {\r\n     try {\r\n         $sql = \"SELECT m.nama_mahasiswa, COUNT(lm.id) AS application_count\r\n"
                },
                {
                    "date": 1721777446476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n \r\n function fetchCDCData($pdo, $user_id)\r\n {\r\n     try {\r\n-        $sql = \"SELECT * FROM admins WHERE user_id = :user_id\";\r\n+        $sql = \"SELECT * FROM cdcs WHERE user_id = :user_id\";\r\n         $stmt = $pdo->prepare($sql);\r\n         $stmt->execute(['user_id' => $user_id]);\r\n         return $stmt->fetch(PDO::FETCH_ASSOC);\r\n     } catch (PDOException $e) {\r\n@@ -52,8 +52,10 @@\n         return false;\r\n     }\r\n }\r\n \r\n+$admin_data = fetchCDCData($pdo, $_SESSION['user_id']);\r\n+\r\n $overview = fetchOverviewStatistics($pdo);\r\n $chart_data = fetchChartData($pdo);\r\n ?>\r\n \r\n"
                },
                {
                    "date": 1721777480434,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,9 +108,9 @@\n                     <div class=\"row\">\r\n                         <div class=\"col-lg-8 col-12\">\r\n                             <div class=\"verified-card\">\r\n                                 <i class=\"fas fa-user\"></i>\r\n-                                <h6>Selamat Datang, <?php echo htmlspecialchars($admin_data['nama_admin']); ?></h6>\r\n+                                <h6>Selamat Datang, <?php echo htmlspecialchars($admin_data['nama_cdc']); ?></h6>\r\n                             </div>\r\n                         </div>\r\n                         <div class=\"col-lg-4 col-12\">\r\n                             <div class=\"date-card\">\r\n"
                }
            ],
            "date": 1721777302117,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\nif (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'cdc') {\r\n    header('Location: ../auth/login.php');\r\n    exit;\r\n}\r\n\r\ninclude '../includes/db.php';\r\n\r\n// Fetch overview statistics\r\nfunction fetchOverviewStatistics($pdo) {\r\n    try {\r\n        $sql = \"SELECT \r\n                    (SELECT COUNT(*) FROM mahasiswas) AS total_students,\r\n                    (SELECT COUNT(*) FROM lamaran_mahasiswas) AS total_applications,\r\n                    (SELECT COUNT(*) FROM lamaran_mahasiswas WHERE status = 'Diterima') AS accepted_applications,\r\n                    (SELECT COUNT(*) FROM lamaran_mahasiswas WHERE status = 'Ditolak') AS rejected_applications\";\r\n        $stmt = $pdo->query($sql);\r\n        return $stmt->fetch(PDO::FETCH_ASSOC);\r\n    } catch (PDOException $e) {\r\n        echo \"Error fetching overview statistics: \" . $e->getMessage();\r\n        return false;\r\n    }\r\n}\r\n\r\n// Fetch data for charts\r\nfunction fetchChartData($pdo) {\r\n    try {\r\n        $sql = \"SELECT m.nama_mahasiswa, COUNT(lm.id) AS application_count\r\n                FROM mahasiswas m\r\n                LEFT JOIN lamaran_mahasiswas lm ON m.id = lm.mahasiswa_id\r\n                GROUP BY m.id, m.nama_mahasiswa\r\n                ORDER BY application_count DESC\r\n                LIMIT 10\";\r\n        $stmt = $pdo->query($sql);\r\n        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    } catch (PDOException $e) {\r\n        echo \"Error fetching chart data: \" . $e->getMessage();\r\n        return false;\r\n    }\r\n}\r\n\r\n$overview = fetchOverviewStatistics($pdo);\r\n$chart_data = fetchChartData($pdo);\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>CDC Dashboard</title>\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/fontawesome-free/css/all.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.dark.min.css\" media=\"screen\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.light.min.css\" media=\"screen\">\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700\" rel=\"stylesheet\">\r\n    <style>\r\n    .nav-sidebar .nav-link.active {\r\n        background-color: #343a40 !important;\r\n    }\r\n    </style>\r\n</head>\r\n\r\n<body class=\"hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed\">\r\n    <div class=\"wrapper\">\r\n        <!-- Navbar -->\r\n        <?php include 'navbar_cdc.php'; ?>\r\n\r\n        <!-- Content Wrapper -->\r\n        <div class=\"content-wrapper\">\r\n            <div class=\"content-header\">\r\n                <div class=\"container-fluid\">\r\n                    <div class=\"row mb-2\">\r\n                        <div class=\"col-sm-6\">\r\n                            <h1 class=\"m-0\">Dashboard</h1>\r\n                        </div>\r\n                        <div class=\"col-sm-6\">\r\n                            <ol class=\"breadcrumb float-sm-right\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"#\">Home</a></li>\r\n                                <li class=\"breadcrumb-item active\">Dashboard</li>\r\n                            </ol>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Main content -->\r\n            <section class=\"content\">\r\n                <div class=\"container-fluid\">\r\n                    <!-- Welcome Card -->\r\n                    <div class=\"row\">\r\n                        <div class=\"col-lg-8 col-12\">\r\n                            <div class=\"verified-card\">\r\n                                <i class=\"fas fa-user\"></i>\r\n                                <h6>Selamat Datang, <?php echo htmlspecialchars($admin_data['nama_admin']); ?></h6>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"col-lg-4 col-12\">\r\n                            <div class=\"date-card\">\r\n                                <i class=\"fas fa-calendar-alt\"></i>\r\n                                <h6>Hari ini: <?php echo $currentDate; ?></h6>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"container-fluid\">\r\n                        <!-- Overview cards -->\r\n                        <div class=\"row\">\r\n                            <div class=\"col-lg-3 col-6\">\r\n                                <!-- Total Students -->\r\n                                <div class=\"small-box bg-info\">\r\n                                    <div class=\"inner\">\r\n                                        <h3><?php echo $overview['total_students']; ?></h3>\r\n                                        <p>Total Students</p>\r\n                                    </div>\r\n                                    <div class=\"icon\">\r\n                                        <i class=\"ion ion-person\"></i>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"col-lg-3 col-6\">\r\n                                <!-- Total Applications -->\r\n                                <div class=\"small-box bg-success\">\r\n                                    <div class=\"inner\">\r\n                                        <h3><?php echo $overview['total_applications']; ?></h3>\r\n                                        <p>Total Applications</p>\r\n                                    </div>\r\n                                    <div class=\"icon\">\r\n                                        <i class=\"ion ion-paper-airplane\"></i>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"col-lg-3 col-6\">\r\n                                <!-- Accepted Applications -->\r\n                                <div class=\"small-box bg-warning\">\r\n                                    <div class=\"inner\">\r\n                                        <h3><?php echo $overview['accepted_applications']; ?></h3>\r\n                                        <p>Accepted Applications</p>\r\n                                    </div>\r\n                                    <div class=\"icon\">\r\n                                        <i class=\"ion ion-checkmark\"></i>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"col-lg-3 col-6\">\r\n                                <!-- Rejected Applications -->\r\n                                <div class=\"small-box bg-danger\">\r\n                                    <div class=\"inner\">\r\n                                        <h3><?php echo $overview['rejected_applications']; ?></h3>\r\n                                        <p>Rejected Applications</p>\r\n                                    </div>\r\n                                    <div class=\"icon\">\r\n                                        <i class=\"ion ion-close\"></i>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- Charts -->\r\n                        <div class=\"row\">\r\n                            <section class=\"col-lg-7 connectedSortable\">\r\n                                <!-- Applications Chart -->\r\n                                <div class=\"card\">\r\n                                    <div class=\"card-header\">\r\n                                        <h3 class=\"card-title\">\r\n                                            <i class=\"fas fa-chart-pie mr-1\"></i>\r\n                                            Applications by Student\r\n                                        </h3>\r\n                                        <div class=\"card-tools\">\r\n                                            <ul class=\"nav nav-pills ml-auto\">\r\n                                                <li class=\"nav-item\">\r\n                                                    <a class=\"nav-link active\" href=\"#chart-area\"\r\n                                                        data-toggle=\"tab\">Chart</a>\r\n                                                </li>\r\n                                            </ul>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div class=\"card-body\">\r\n                                        <div class=\"tab-content p-0\">\r\n                                            <!-- Morris chart - Sales -->\r\n                                            <div class=\"chart tab-pane active\" id=\"chart-area\"\r\n                                                style=\"position: relative; height: 300px;\">\r\n                                                <canvas id=\"applicationsChart\" height=\"300\"\r\n                                                    style=\"height: 300px;\"></canvas>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div><!-- /.card-body -->\r\n                                </div>\r\n                            </section>\r\n                            <section class=\"col-lg-5 connectedSortable\">\r\n                                <!-- Another chart or any other component can go here -->\r\n                            </section>\r\n                        </div>\r\n                    </div><!-- /.container-fluid -->\r\n            </section>\r\n        </div><!-- /.content-wrapper -->\r\n    </div>\r\n\r\n    <script src=\"script_cdc.js\"></script>\r\n    <script src=\"../app/plugins/jquery/jquery.min.js\"></script>\r\n    <script src=\"../app/plugins/bootstrap/js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n    <script>\r\n    // Chart.js - Applications Chart\r\n    var ctx = document.getElementById('applicationsChart').getContext('2d');\r\n    var applicationsChart = new Chart(ctx, {\r\n        type: 'bar',\r\n        data: {\r\n            labels: <?php echo json_encode(array_column($chart_data, 'nama_mahasiswa')); ?>,\r\n            datasets: [{\r\n                label: 'Applications',\r\n                data: <?php echo json_encode(array_column($chart_data, 'application_count')); ?>,\r\n                backgroundColor: 'rgba(60,141,188,0.9)',\r\n                borderColor: 'rgba(60,141,188,0.8)',\r\n                borderWidth: 1\r\n            }]\r\n        },\r\n        options: {\r\n            maintainAspectRatio: false,\r\n            responsive: true,\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true\r\n                }\r\n            }\r\n        }\r\n    });\r\n    </script>\r\n\r\n</body>\r\n\r\n</html>"
        }
    ]
}