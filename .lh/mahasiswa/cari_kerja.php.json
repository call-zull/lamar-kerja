{
    "sourceFile": "mahasiswa/cari_kerja.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1721785221097,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1721785347741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,30 +7,8 @@\n \r\n $user_id = $_SESSION['user_id'];\r\n include '../includes/db.php';\r\n \r\n-\r\n-function fetchAllJobs($pdo, $search = '')\r\n-{\r\n-    try {\r\n-        $sql = \"SELECT * FROM lowongan_kerja\";\r\n-        if (!empty($search)) {\r\n-            $search = '%' . $search . '%';\r\n-            $sql .= \" WHERE nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search\";\r\n-        }\r\n-        $stmt = $pdo->prepare($sql);\r\n-        if (!empty($search)) {\r\n-            $stmt->execute(['search' => $search]);\r\n-        } else {\r\n-            $stmt->execute();\r\n-        }\r\n-        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n-    } catch (PDOException $e) {\r\n-        error_log(\"Error: \" . $e->getMessage());\r\n-        return false;\r\n-    }\r\n-}\r\n-\r\n function fetchMahasiswaDetails($pdo, $user_id) {\r\n     try {\r\n         $sql = \"SELECT prodi_id, keahlian, ijazah, resume, khs_semester_1, khs_semester_2, khs_semester_3, khs_semester_4, khs_semester_5, khs_semester_6, khs_semester_7, khs_semester_8, ipk_semester_1, ipk_semester_2, ipk_semester_3, ipk_semester_4, ipk_semester_5, ipk_semester_6, ipk_semester_7, ipk_semester_8 FROM mahasiswas WHERE user_id = :user_id\";\r\n         $stmt = $pdo->prepare($sql);\r\n@@ -52,10 +30,9 @@\n             $stmt->execute(['search' => $search]);\r\n         } else {\r\n             $stmt = $pdo->query($sql);\r\n         }\r\n-        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n-        return $jobs;\r\n+        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n     } catch (PDOException $e) {\r\n         error_log(\"Error: \" . $e->getMessage());\r\n         return false;\r\n     }\r\n@@ -76,10 +53,9 @@\n         if (!empty($search)) {\r\n             $params['search'] = $search;\r\n         }\r\n         $stmt->execute($params);\r\n-        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n-        return $jobs;\r\n+        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n     } catch (PDOException $e) {\r\n         error_log(\"Error: \" . $e->getMessage());\r\n         return false;\r\n     }\r\n@@ -206,112 +182,113 @@\n                             $stmt = $pdo->prepare($sql);\r\n                             $stmt->execute(['lowongan_id' => $row['id'], 'mahasiswa_id' => $user_id]);\r\n                             $has_applied = $stmt->fetchColumn() > 0;\r\n                             ?>\r\n-                                <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n-                                    <div class=\"card\">\r\n-                                        <div class=\"card-body\">\r\n-                                            <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n+                        <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n+                            <div class=\"card\">\r\n+                                <div class=\"card-body\">\r\n+                                    <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n                                     <p class=\"card-text\"><strong>Posisi:</strong>\r\n                                         <?php echo htmlspecialchars($row['posisi']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Kualifikasi:</strong>\r\n                                         <?php echo htmlspecialchars($row['kualifikasi']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Program Studi:</strong>\r\n                                         <?php foreach ($prodi as $p) {\r\n                                                 echo htmlspecialchars($p['value']) . '<br>';\r\n                                             } ?>\r\n-                                            </p>\r\n-                                            <p class=\"card-text\"><strong>Keahlian:</strong>\r\n+                                    </p>\r\n+                                    <p class=\"card-text\"><strong>Keahlian:</strong>\r\n                                         <?php foreach ($keahlian as $k) {\r\n                                                 echo htmlspecialchars($k['value']) . '<br>';\r\n                                             } ?>\r\n                                     </p>\r\n                                     <p class=\"card-text\"><strong>Tanggal Posting:</strong>\r\n                                         <?php echo htmlspecialchars($row['tanggal_posting']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Batas Waktu:</strong>\r\n                                         <?php echo htmlspecialchars($row['batas_waktu']); ?></p>\r\n+                                    <p class=\"card-text\"><strong>Jobdesk:</strong>\r\n+                                        <?php echo htmlspecialchars($row['jobdesk']); ?></p>\r\n+                                    <p class=\"card-text\"><strong>Range Gaji:</strong>\r\n+                                        <?php echo htmlspecialchars($row['range_gajih']); ?></p>\r\n+                                    <p class=\"card-text\"><strong>Jenis Kerja:</strong>\r\n+                                        <?php echo htmlspecialchars($row['jenis_kerja']); ?></p>\r\n+                                    <p class=\"card-text\"><strong>Sistem Kerja:</strong>\r\n+                                        <?php echo htmlspecialchars($row['sistem_kerja']); ?></p>\r\n                                     <?php if ($is_expired): ?>\r\n-                                        <button class='btn btn-secondary btn-sm' disabled>Lamaran Expired</button>\r\n+                                    <button class='btn btn-secondary btn-sm' disabled>Lamaran Expired</button>\r\n                                     <?php elseif ($has_applied): ?>\r\n-                                        <button class='btn btn-secondary btn-sm' disabled>Menunggu Balasan</button>\r\n+                                    <button class='btn btn-secondary btn-sm' disabled>Menunggu Balasan</button>\r\n                                     <?php else: ?>\r\n-                                        <button class='btn btn-success btn-sm' data-toggle='modal' data-target='#modalLamar' data-id=\"<?php echo $row['id']; ?>\"\r\n-                                            data-mahasiswa=\"<?php echo $user_id; ?>\">Lamar</button>\r\n+                                    <button class='btn btn-success btn-sm' data-toggle='modal' data-target='#modalLamar'\r\n+                                        data-id=\"<?php echo $row['id']; ?>\"\r\n+                                        data-mahasiswa=\"<?php echo $user_id; ?>\">Lamar</button>\r\n                                     <?php endif; ?>\r\n-                                            <button class='btn btn-primary btn-sm' data-toggle='modal' data-target='#modalDetailPerusahaan'\r\n-                                                data-perusahaan-id=\"<?php echo $row['perusahaan_id']; ?>\">Detail\r\n+                                    <button class='btn btn-primary btn-sm' data-toggle='modal'\r\n+                                        data-target='#modalDetailPerusahaan'\r\n+                                        data-perusahaan-id=\"<?php echo $row['perusahaan_id']; ?>\">Detail\r\n                                         Perusahaan</button>\r\n-                                    </div>\r\n-                                    </div>\r\n-                                    </div>\r\n+                                </div>\r\n+                            </div>\r\n+                        </div>\r\n                         <?php endforeach; ?>\r\n                         <?php else: ?>\r\n                         <p>Tidak ada data</p>\r\n                         <?php endif; ?>\r\n-                        </div>\r\n-                        </div>\r\n-                        </section>\r\n-                        </div>\r\n-                        </div>\r\n+                    </div>\r\n+                </div>\r\n+            </section>\r\n+        </div>\r\n+    </div>\r\n \r\n-    <!-- Form modal for applying to job -->\r\n-    <div class=\"modal fade\" id=\"modalLamar\" tabindex=\"-1\" aria-labelledby=\"modalLamarLabel\" aria-hidden=\"true\">\r\n-        <div class=\"modal-dialog modal-dialog-centered\">\r\n+    <!-- Modal untuk melamar -->\r\n+    <div class=\"modal fade\" id=\"modalLamar\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"modalLamarLabel\"\r\n+        aria-hidden=\"true\">\r\n+        <div class=\"modal-dialog\" role=\"document\">\r\n             <div class=\"modal-content\">\r\n                 <div class=\"modal-header\">\r\n-                    <h5 class=\"modal-title\" id=\"modalLamarLabel\">Lamar Pekerjaan</h5>\r\n+                    <h5 class=\"modal-title\" id=\"modalLamarLabel\">Lamar Lowongan</h5>\r\n                     <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                         <span aria-hidden=\"true\">&times;</span>\r\n                     </button>\r\n                 </div>\r\n                 <div class=\"modal-body\">\r\n-                    <form id=\"formLamar\" method=\"POST\" action=\"lamar_kerja.php\">\r\n-                        <input type=\"hidden\" name=\"lowongan_id\" id=\"lowongan_id\">\r\n-                        <input type=\"hidden\" name=\"mahasiswa_id\" id=\"mahasiswa_id\">\r\n+                    <form method=\"POST\" action=\"proses_lamar.php\">\r\n+                        <input type=\"hidden\" id=\"lowongan_id\" name=\"lowongan_id\">\r\n+                        <input type=\"hidden\" id=\"mahasiswa_id\" name=\"mahasiswa_id\" value=\"<?php echo $user_id; ?>\">\r\n                         <div class=\"form-group\">\r\n-                            <label for=\"pesan\">Pesan</label>\r\n-                            <textarea class=\"form-control\" name=\"pesan\" id=\"pesan\" rows=\"5\" required></textarea>\r\n+                            <label for=\"cover_letter\">Cover Letter</label>\r\n+                            <textarea class=\"form-control\" id=\"cover_letter\" name=\"cover_letter\" rows=\"4\"\r\n+                                required></textarea>\r\n                         </div>\r\n                         <div class=\"form-group\">\r\n-                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnTranskipIjazah\"\r\n-                                onclick=\"insertTranskipIjazah()\">Masukkan Transkip/Ijazah</button>\r\n-                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnCV\" onclick=\"insertCV()\">Masukkan\r\n-                                CV</button>\r\n-                            <?php for ($i = 1; $i <= $valid_semesters; $i++): ?>\r\n-                                <button type=\"button\" class=\"btn btn-secondary khs-btn\" id=\"btnKHS<?= $i ?>\" onclick=\"insertKHS(<?= $i ?>)\">Masukkan KHS\r\n-                                Semester <?= $i ?></button>\r\n-                            <?php endfor; ?>\r\n-                            </div>\r\n-                            <input type=\"hidden\" name=\"transkip_ijazah\" id=\"transkip_ijazah\">\r\n-                            <input type=\"hidden\" name=\"cv\" id=\"cv\">\r\n-                            <input type=\"hidden\" name=\"khs\" id=\"khs\">\r\n+                            <label for=\"resume\">Resume (File PDF)</label>\r\n+                            <input type=\"file\" class=\"form-control-file\" id=\"resume\" name=\"resume\" accept=\".pdf\"\r\n+                                required>\r\n+                        </div>\r\n+                        <div class=\"form-group\">\r\n                             <button type=\"submit\" class=\"btn btn-primary\">Kirim Lamaran</button>\r\n-                            </form>\r\n-                            </div>\r\n-                            </div>\r\n-                            </div>\r\n-                            </div>\r\n+                        </div>\r\n+                    </form>\r\n+                </div>\r\n+            </div>\r\n+        </div>\r\n+    </div>\r\n \r\n-\r\n-    <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" aria-labelledby=\"modalDetailPerusahaanLabel\"\r\n-        aria-hidden=\"true\">\r\n-        <div class=\"modal-dialog modal-dialog-centered\">\r\n+    <!-- Modal untuk detail perusahaan -->\r\n+    <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" role=\"dialog\"\r\n+        aria-labelledby=\"modalDetailPerusahaanLabel\" aria-hidden=\"true\">\r\n+        <div class=\"modal-dialog\" role=\"document\">\r\n             <div class=\"modal-content\">\r\n                 <div class=\"modal-header\">\r\n                     <h5 class=\"modal-title\" id=\"modalDetailPerusahaanLabel\">Detail Perusahaan</h5>\r\n                     <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                         <span aria-hidden=\"true\">&times;</span>\r\n                     </button>\r\n                 </div>\r\n                 <div class=\"modal-body\">\r\n-                    <p><strong>Nama Perusahaan:</strong> <span id=\"detailNamaPerusahaan\"></span></p>\r\n-                    <p><strong>Alamat Perusahaan:</strong> <span id=\"detailAlamatPerusahaan\"></span></p>\r\n-                    <p><strong>Email Perusahaan:</strong> <span id=\"detailEmailPerusahaan\"></span></p>\r\n-                    <p><strong>Jenis Perusahaan:</strong> <span id=\"detailJenisPerusahaan\"></span></p>\r\n-                    <p><strong>Tahun Didirikan:</strong> <span id=\"detailTahunDidirikan\"></span></p>\r\n-                    <p><strong>Pimpinan Perusahaan:</strong> <span id=\"detailPimpinanPerusahaan\"></span></p>\r\n-                    <p><strong>Deskripsi Perusahaan:</strong> <span id=\"detailDeskripsiPerusahaan\"></span></p>\r\n-                    <p><strong>No Telp:</strong> <span id=\"detailNoTelp\"></span></p>\r\n+                    <div id=\"detail-perusahaan-content\">\r\n+                        <!-- Detail perusahaan akan dimuat di sini -->\r\n+                    </div>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n@@ -321,118 +298,30 @@\n     <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n     <script>\r\n     $('#modalLamar').on('show.bs.modal', function(event) {\r\n         var button = $(event.relatedTarget);\r\n-        var id = button.data('id');\r\n-        var mahasiswa = button.data('mahasiswa');\r\n-\r\n+        var lowonganId = button.data('id');\r\n+        var mahasiswaId = button.data('mahasiswa');\r\n         var modal = $(this);\r\n-        modal.find('#lowongan_id').val(id);\r\n-        modal.find('#mahasiswa_id').val(mahasiswa);\r\n-\r\n-        // Reset button colors\r\n-        $('#btnTranskipIjazah').removeClass('btn-success').addClass('btn-secondary');\r\n-        $('#btnCV').removeClass('btn-success').addClass('btn-secondary');\r\n-        $('.khs-btn').removeClass('btn-success').addClass('btn-secondary');\r\n-\r\n-        // Reset hidden inputs\r\n-        $('#transkip_ijazah').val('');\r\n-        $('#cv').val('');\r\n-        $('#khs').val('');\r\n+        modal.find('#lowongan_id').val(lowonganId);\r\n+        modal.find('#mahasiswa_id').val(mahasiswaId);\r\n     });\r\n \r\n     $('#modalDetailPerusahaan').on('show.bs.modal', function(event) {\r\n         var button = $(event.relatedTarget);\r\n         var perusahaanId = button.data('perusahaan-id');\r\n-\r\n         var modal = $(this);\r\n-\r\n         $.ajax({\r\n             url: 'get_perusahaan_detail.php',\r\n             method: 'GET',\r\n             data: {\r\n-                user_id: perusahaanId\r\n+                id: perusahaanId\r\n             },\r\n             success: function(response) {\r\n-                var details = JSON.parse(response);\r\n-                if (details.error) {\r\n-                    modal.find('#detailNamaPerusahaan').text(\"Data tidak ditemukan\");\r\n-                    modal.find('#detailAlamatPerusahaan').text(\"\");\r\n-                    modal.find('#detailEmailPerusahaan').text(\"\");\r\n-                    modal.find('#detailJenisPerusahaan').text(\"\");\r\n-                    modal.find('#detailTahunDidirikan').text(\"\");\r\n-                    modal.find('#detailPimpinanPerusahaan').text(\"\");\r\n-                    modal.find('#detailDeskripsiPerusahaan').text(\"\");\r\n-                    modal.find('#detailNoTelp').text(\"\");\r\n-                } else {\r\n-                    modal.find('#detailNamaPerusahaan').text(details.nama_perusahaan);\r\n-                    modal.find('#detailAlamatPerusahaan').text(details.alamat_perusahaan);\r\n-                    modal.find('#detailEmailPerusahaan').text(details.email_perusahaan);\r\n-                    modal.find('#detailJenisPerusahaan').text(details.nama_jenis);\r\n-                    modal.find('#detailTahunDidirikan').text(details.tahun_didirikan);\r\n-                    modal.find('#detailPimpinanPerusahaan').text(details.pimpinan_perusahaan);\r\n-                    modal.find('#detailDeskripsiPerusahaan').text(details.deskripsi_perusahaan);\r\n-                    modal.find('#detailNoTelp').text(details.no_telp);\r\n-                }\r\n-            },\r\n-            error: function(xhr, status, error) {\r\n-                console.error(\"Error: \" + error);\r\n+                modal.find('#detail-perusahaan-content').html(response);\r\n             }\r\n         });\r\n     });\r\n-\r\n-    function insertTranskipIjazah() {\r\n-        var transkipIjazah = \"<?php echo $mahasiswa['ijazah']; ?>\";\r\n-        document.getElementById('transkip_ijazah').value = transkipIjazah;\r\n-        document.getElementById('btnTranskipIjazah').classList.remove('btn-secondary');\r\n-        document.getElementById('btnTranskipIjazah').classList.add('btn-success');\r\n-        alert(\"Transkip/Ijazah ditambahkan: \" + transkipIjazah);\r\n-    }\r\n-\r\n-    function insertCV() {\r\n-        var cv = \"<?php echo $mahasiswa['resume']; ?>\";\r\n-        document.getElementById('cv').value = cv;\r\n-        document.getElementById('btnCV').classList.remove('btn-secondary');\r\n-        document.getElementById('btnCV').classList.add('btn-success');\r\n-        alert(\"CV ditambahkan: \" + cv);\r\n-    }\r\n-\r\n-    function insertKHS(semester) {\r\n-        var khs = \"\";\r\n-        switch (semester) {\r\n-            case 1:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_1']; ?>\";\r\n-                break;\r\n-            case 2:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_2']; ?>\";\r\n-                break;\r\n-            case 3:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_3']; ?>\";\r\n-                break;\r\n-            case 4:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_4']; ?>\";\r\n-                break;\r\n-            case 5:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_5']; ?>\";\r\n-                break;\r\n-            case 6:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_6']; ?>\";\r\n-                break;\r\n-            case 7:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_7']; ?>\";\r\n-                break;\r\n-            case 8:\r\n-                khs = \"<?php echo $mahasiswa['khs_semester_8']; ?>\";\r\n-                break;\r\n-            default:\r\n-                alert(\"Semester tidak valid\");\r\n-                return;\r\n-        }\r\n-        document.getElementById('khs').value = khs;\r\n-        document.getElementById('btnKHS' + semester).classList.remove('btn-secondary');\r\n-        document.getElementById('btnKHS' + semester).classList.add('btn-success');\r\n-        alert(\"KHS Semester \" + semester + \" ditambahkan: \" + khs);\r\n-    }\r\n     </script>\r\n </body>\r\n \r\n </html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1721785417956,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,8 +7,30 @@\n \r\n $user_id = $_SESSION['user_id'];\r\n include '../includes/db.php';\r\n \r\n+\r\n+function fetchAllJobs($pdo, $search = '')\r\n+{\r\n+    try {\r\n+        $sql = \"SELECT * FROM lowongan_kerja\";\r\n+        if (!empty($search)) {\r\n+            $search = '%' . $search . '%';\r\n+            $sql .= \" WHERE nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search\";\r\n+        }\r\n+        $stmt = $pdo->prepare($sql);\r\n+        if (!empty($search)) {\r\n+            $stmt->execute(['search' => $search]);\r\n+        } else {\r\n+            $stmt->execute();\r\n+        }\r\n+        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n+    } catch (PDOException $e) {\r\n+        error_log(\"Error: \" . $e->getMessage());\r\n+        return false;\r\n+    }\r\n+}\r\n+\r\n function fetchMahasiswaDetails($pdo, $user_id) {\r\n     try {\r\n         $sql = \"SELECT prodi_id, keahlian, ijazah, resume, khs_semester_1, khs_semester_2, khs_semester_3, khs_semester_4, khs_semester_5, khs_semester_6, khs_semester_7, khs_semester_8, ipk_semester_1, ipk_semester_2, ipk_semester_3, ipk_semester_4, ipk_semester_5, ipk_semester_6, ipk_semester_7, ipk_semester_8 FROM mahasiswas WHERE user_id = :user_id\";\r\n         $stmt = $pdo->prepare($sql);\r\n@@ -30,9 +52,10 @@\n             $stmt->execute(['search' => $search]);\r\n         } else {\r\n             $stmt = $pdo->query($sql);\r\n         }\r\n-        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n+        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n+        return $jobs;\r\n     } catch (PDOException $e) {\r\n         error_log(\"Error: \" . $e->getMessage());\r\n         return false;\r\n     }\r\n@@ -53,9 +76,10 @@\n         if (!empty($search)) {\r\n             $params['search'] = $search;\r\n         }\r\n         $stmt->execute($params);\r\n-        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n+        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n+        return $jobs;\r\n     } catch (PDOException $e) {\r\n         error_log(\"Error: \" . $e->getMessage());\r\n         return false;\r\n     }\r\n@@ -182,111 +206,115 @@\n                             $stmt = $pdo->prepare($sql);\r\n                             $stmt->execute(['lowongan_id' => $row['id'], 'mahasiswa_id' => $user_id]);\r\n                             $has_applied = $stmt->fetchColumn() > 0;\r\n                             ?>\r\n-                                <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n-                                    <div class=\"card\">\r\n-                                        <div class=\"card-body\">\r\n-                                            <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n+                        <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n+                            <div class=\"card\">\r\n+                                <div class=\"card-body\">\r\n+                                    <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n                                     <p class=\"card-text\"><strong>Posisi:</strong>\r\n                                         <?php echo htmlspecialchars($row['posisi']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Kualifikasi:</strong>\r\n                                         <?php echo htmlspecialchars($row['kualifikasi']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Program Studi:</strong>\r\n                                         <?php foreach ($prodi as $p) {\r\n                                                 echo htmlspecialchars($p['value']) . '<br>';\r\n                                             } ?>\r\n-                                            </p>\r\n-                                            <p class=\"card-text\"><strong>Keahlian:</strong>\r\n+                                    </p>\r\n+                                    <p class=\"card-text\"><strong>Keahlian:</strong>\r\n                                         <?php foreach ($keahlian as $k) {\r\n                                                 echo htmlspecialchars($k['value']) . '<br>';\r\n                                             } ?>\r\n                                     </p>\r\n                                     <p class=\"card-text\"><strong>Tanggal Posting:</strong>\r\n                                         <?php echo htmlspecialchars($row['tanggal_posting']); ?></p>\r\n                                     <p class=\"card-text\"><strong>Batas Waktu:</strong>\r\n                                         <?php echo htmlspecialchars($row['batas_waktu']); ?></p>\r\n-                                    <p class=\"card-text\"><strong>Jobdesk:</strong>\r\n-                                        <?php echo htmlspecialchars($row['jobdesk']); ?></p>\r\n-                                    <p class=\"card-text\"><strong>Range Gaji:</strong>\r\n-                                        <?php echo htmlspecialchars($row['range_gajih']); ?></p>\r\n-                                    <p class=\"card-text\"><strong>Jenis Kerja:</strong>\r\n-                                        <?php echo htmlspecialchars($row['jenis_kerja']); ?></p>\r\n-                                    <p class=\"card-text\"><strong>Sistem Kerja:</strong>\r\n-                                        <?php echo htmlspecialchars($row['sistem_kerja']); ?></p>\r\n                                     <?php if ($is_expired): ?>\r\n-                                        <button class='btn btn-secondary btn-sm' disabled>Lamaran Expired</button>\r\n+                                    <button class='btn btn-secondary btn-sm' disabled>Lamaran Expired</button>\r\n                                     <?php elseif ($has_applied): ?>\r\n-                                        <button class='btn btn-secondary btn-sm' disabled>Menunggu Balasan</button>\r\n+                                    <button class='btn btn-secondary btn-sm' disabled>Menunggu Balasan</button>\r\n                                     <?php else: ?>\r\n-                                        <button class='btn btn-success btn-sm' data-toggle='modal' data-target='#modalLamar' data-id=\"<?php echo $row['id']; ?>\"\r\n-                                            data-mahasiswa=\"<?php echo $user_id; ?>\">Lamar</button>\r\n+                                    <button class='btn btn-success btn-sm' data-toggle='modal' data-target='#modalLamar'\r\n+                                        data-id=\"<?php echo $row['id']; ?>\"\r\n+                                        data-mahasiswa=\"<?php echo $user_id; ?>\">Lamar</button>\r\n                                     <?php endif; ?>\r\n-                                            <button class='btn btn-primary btn-sm' data-toggle='modal' data-target='#modalDetailPerusahaan'\r\n-                                                data-perusahaan-id=\"<?php echo $row['perusahaan_id']; ?>\">Detail\r\n+                                    <button class='btn btn-primary btn-sm' data-toggle='modal'\r\n+                                        data-target='#modalDetailPerusahaan'\r\n+                                        data-perusahaan-id=\"<?php echo $row['perusahaan_id']; ?>\">Detail\r\n                                         Perusahaan</button>\r\n-                                    </div>\r\n-                                    </div>\r\n-                                    </div>\r\n+                                </div>\r\n+                            </div>\r\n+                        </div>\r\n                         <?php endforeach; ?>\r\n                         <?php else: ?>\r\n                         <p>Tidak ada data</p>\r\n                         <?php endif; ?>\r\n-                        </div>\r\n-                        </div>\r\n-                        </section>\r\n-                        </div>\r\n-                        </div>\r\n+                    </div>\r\n+                </div>\r\n+            </section>\r\n+        </div>\r\n+    </div>\r\n \r\n-    <!-- Modal untuk melamar -->\r\n-    <div class=\"modal fade\" id=\"modalLamar\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"modalLamarLabel\"\r\n-        aria-hidden=\"true\">\r\n-        <div class=\"modal-dialog\" role=\"document\">\r\n+    <!-- Form modal for applying to job -->\r\n+    <div class=\"modal fade\" id=\"modalLamar\" tabindex=\"-1\" aria-labelledby=\"modalLamarLabel\" aria-hidden=\"true\">\r\n+        <div class=\"modal-dialog modal-dialog-centered\">\r\n             <div class=\"modal-content\">\r\n                 <div class=\"modal-header\">\r\n-                    <h5 class=\"modal-title\" id=\"modalLamarLabel\">Lamar Lowongan</h5>\r\n+                    <h5 class=\"modal-title\" id=\"modalLamarLabel\">Lamar Pekerjaan</h5>\r\n                     <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                         <span aria-hidden=\"true\">&times;</span>\r\n                     </button>\r\n                 </div>\r\n                 <div class=\"modal-body\">\r\n-                    <form method=\"POST\" action=\"proses_lamar.php\">\r\n-                        <input type=\"hidden\" id=\"lowongan_id\" name=\"lowongan_id\">\r\n-                        <input type=\"hidden\" id=\"mahasiswa_id\" name=\"mahasiswa_id\" value=\"<?php echo $user_id; ?>\">\r\n+                    <form id=\"formLamar\" method=\"POST\" action=\"lamar_kerja.php\">\r\n+                        <input type=\"hidden\" name=\"lowongan_id\" id=\"lowongan_id\">\r\n+                        <input type=\"hidden\" name=\"mahasiswa_id\" id=\"mahasiswa_id\">\r\n                         <div class=\"form-group\">\r\n-                            <label for=\"cover_letter\">Cover Letter</label>\r\n-                            <textarea class=\"form-control\" id=\"cover_letter\" name=\"cover_letter\" rows=\"4\"\r\n-                                required></textarea>\r\n+                            <label for=\"pesan\">Pesan</label>\r\n+                            <textarea class=\"form-control\" name=\"pesan\" id=\"pesan\" rows=\"5\" required></textarea>\r\n                         </div>\r\n                         <div class=\"form-group\">\r\n-                            <label for=\"resume\">Resume (File PDF)</label>\r\n-                            <input type=\"file\" class=\"form-control-file\" id=\"resume\" name=\"resume\" accept=\".pdf\"\r\n-                                required>\r\n+                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnTranskipIjazah\"\r\n+                                onclick=\"insertTranskipIjazah()\">Masukkan Transkip/Ijazah</button>\r\n+                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnCV\" onclick=\"insertCV()\">Masukkan\r\n+                                CV</button>\r\n+                            <?php for ($i = 1; $i <= $valid_semesters; $i++): ?>\r\n+                            <button type=\"button\" class=\"btn btn-secondary khs-btn\" id=\"btnKHS<?= $i ?>\"\r\n+                                onclick=\"insertKHS(<?= $i ?>)\">Masukkan KHS\r\n+                                Semester <?= $i ?></button>\r\n+                            <?php endfor; ?>\r\n                         </div>\r\n-                        <div class=\"form-group\">\r\n-                            <button type=\"submit\" class=\"btn btn-primary\">Kirim Lamaran</button>\r\n-                        </div>\r\n+                        <input type=\"hidden\" name=\"transkip_ijazah\" id=\"transkip_ijazah\">\r\n+                        <input type=\"hidden\" name=\"cv\" id=\"cv\">\r\n+                        <input type=\"hidden\" name=\"khs\" id=\"khs\">\r\n+                        <button type=\"submit\" class=\"btn btn-primary\">Kirim Lamaran</button>\r\n                     </form>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n \r\n-    <!-- Modal untuk detail perusahaan -->\r\n-    <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" role=\"dialog\"\r\n-        aria-labelledby=\"modalDetailPerusahaanLabel\" aria-hidden=\"true\">\r\n-        <div class=\"modal-dialog\" role=\"document\">\r\n+\r\n+    <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" aria-labelledby=\"modalDetailPerusahaanLabel\"\r\n+        aria-hidden=\"true\">\r\n+        <div class=\"modal-dialog modal-dialog-centered\">\r\n             <div class=\"modal-content\">\r\n                 <div class=\"modal-header\">\r\n                     <h5 class=\"modal-title\" id=\"modalDetailPerusahaanLabel\">Detail Perusahaan</h5>\r\n                     <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                         <span aria-hidden=\"true\">&times;</span>\r\n                     </button>\r\n                 </div>\r\n                 <div class=\"modal-body\">\r\n-                    <div id=\"detail-perusahaan-content\">\r\n-                        <!-- Detail perusahaan akan dimuat di sini -->\r\n-                    </div>\r\n+                    <p><strong>Nama Perusahaan:</strong> <span id=\"detailNamaPerusahaan\"></span></p>\r\n+                    <p><strong>Alamat Perusahaan:</strong> <span id=\"detailAlamatPerusahaan\"></span></p>\r\n+                    <p><strong>Email Perusahaan:</strong> <span id=\"detailEmailPerusahaan\"></span></p>\r\n+                    <p><strong>Jenis Perusahaan:</strong> <span id=\"detailJenisPerusahaan\"></span></p>\r\n+                    <p><strong>Tahun Didirikan:</strong> <span id=\"detailTahunDidirikan\"></span></p>\r\n+                    <p><strong>Pimpinan Perusahaan:</strong> <span id=\"detailPimpinanPerusahaan\"></span></p>\r\n+                    <p><strong>Deskripsi Perusahaan:</strong> <span id=\"detailDeskripsiPerusahaan\"></span></p>\r\n+                    <p><strong>No Telp:</strong> <span id=\"detailNoTelp\"></span></p>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n@@ -296,30 +324,118 @@\n     <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n     <script>\r\n     $('#modalLamar').on('show.bs.modal', function(event) {\r\n         var button = $(event.relatedTarget);\r\n-        var lowonganId = button.data('id');\r\n-        var mahasiswaId = button.data('mahasiswa');\r\n+        var id = button.data('id');\r\n+        var mahasiswa = button.data('mahasiswa');\r\n+\r\n         var modal = $(this);\r\n-        modal.find('#lowongan_id').val(lowonganId);\r\n-        modal.find('#mahasiswa_id').val(mahasiswaId);\r\n+        modal.find('#lowongan_id').val(id);\r\n+        modal.find('#mahasiswa_id').val(mahasiswa);\r\n+\r\n+        // Reset button colors\r\n+        $('#btnTranskipIjazah').removeClass('btn-success').addClass('btn-secondary');\r\n+        $('#btnCV').removeClass('btn-success').addClass('btn-secondary');\r\n+        $('.khs-btn').removeClass('btn-success').addClass('btn-secondary');\r\n+\r\n+        // Reset hidden inputs\r\n+        $('#transkip_ijazah').val('');\r\n+        $('#cv').val('');\r\n+        $('#khs').val('');\r\n     });\r\n \r\n     $('#modalDetailPerusahaan').on('show.bs.modal', function(event) {\r\n         var button = $(event.relatedTarget);\r\n         var perusahaanId = button.data('perusahaan-id');\r\n+\r\n         var modal = $(this);\r\n+\r\n         $.ajax({\r\n             url: 'get_perusahaan_detail.php',\r\n             method: 'GET',\r\n             data: {\r\n-                id: perusahaanId\r\n+                user_id: perusahaanId\r\n             },\r\n             success: function(response) {\r\n-                modal.find('#detail-perusahaan-content').html(response);\r\n+                var details = JSON.parse(response);\r\n+                if (details.error) {\r\n+                    modal.find('#detailNamaPerusahaan').text(\"Data tidak ditemukan\");\r\n+                    modal.find('#detailAlamatPerusahaan').text(\"\");\r\n+                    modal.find('#detailEmailPerusahaan').text(\"\");\r\n+                    modal.find('#detailJenisPerusahaan').text(\"\");\r\n+                    modal.find('#detailTahunDidirikan').text(\"\");\r\n+                    modal.find('#detailPimpinanPerusahaan').text(\"\");\r\n+                    modal.find('#detailDeskripsiPerusahaan').text(\"\");\r\n+                    modal.find('#detailNoTelp').text(\"\");\r\n+                } else {\r\n+                    modal.find('#detailNamaPerusahaan').text(details.nama_perusahaan);\r\n+                    modal.find('#detailAlamatPerusahaan').text(details.alamat_perusahaan);\r\n+                    modal.find('#detailEmailPerusahaan').text(details.email_perusahaan);\r\n+                    modal.find('#detailJenisPerusahaan').text(details.nama_jenis);\r\n+                    modal.find('#detailTahunDidirikan').text(details.tahun_didirikan);\r\n+                    modal.find('#detailPimpinanPerusahaan').text(details.pimpinan_perusahaan);\r\n+                    modal.find('#detailDeskripsiPerusahaan').text(details.deskripsi_perusahaan);\r\n+                    modal.find('#detailNoTelp').text(details.no_telp);\r\n+                }\r\n+            },\r\n+            error: function(xhr, status, error) {\r\n+                console.error(\"Error: \" + error);\r\n             }\r\n         });\r\n     });\r\n+\r\n+    function insertTranskipIjazah() {\r\n+        var transkipIjazah = \"<?php echo $mahasiswa['ijazah']; ?>\";\r\n+        document.getElementById('transkip_ijazah').value = transkipIjazah;\r\n+        document.getElementById('btnTranskipIjazah').classList.remove('btn-secondary');\r\n+        document.getElementById('btnTranskipIjazah').classList.add('btn-success');\r\n+        alert(\"Transkip/Ijazah ditambahkan: \" + transkipIjazah);\r\n+    }\r\n+\r\n+    function insertCV() {\r\n+        var cv = \"<?php echo $mahasiswa['resume']; ?>\";\r\n+        document.getElementById('cv').value = cv;\r\n+        document.getElementById('btnCV').classList.remove('btn-secondary');\r\n+        document.getElementById('btnCV').classList.add('btn-success');\r\n+        alert(\"CV ditambahkan: \" + cv);\r\n+    }\r\n+\r\n+    function insertKHS(semester) {\r\n+        var khs = \"\";\r\n+        switch (semester) {\r\n+            case 1:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_1']; ?>\";\r\n+                break;\r\n+            case 2:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_2']; ?>\";\r\n+                break;\r\n+            case 3:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_3']; ?>\";\r\n+                break;\r\n+            case 4:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_4']; ?>\";\r\n+                break;\r\n+            case 5:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_5']; ?>\";\r\n+                break;\r\n+            case 6:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_6']; ?>\";\r\n+                break;\r\n+            case 7:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_7']; ?>\";\r\n+                break;\r\n+            case 8:\r\n+                khs = \"<?php echo $mahasiswa['khs_semester_8']; ?>\";\r\n+                break;\r\n+            default:\r\n+                alert(\"Semester tidak valid\");\r\n+                return;\r\n+        }\r\n+        document.getElementById('khs').value = khs;\r\n+        document.getElementById('btnKHS' + semester).classList.remove('btn-secondary');\r\n+        document.getElementById('btnKHS' + semester).classList.add('btn-success');\r\n+        alert(\"KHS Semester \" + semester + \" ditambahkan: \" + khs);\r\n+    }\r\n     </script>\r\n </body>\r\n \r\n </html>\n\\ No newline at end of file\n"
                }
            ],
            "date": 1721785221097,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\nif (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'mahasiswa') {\r\n    header('Location: ../auth/login.php');\r\n    exit;\r\n}\r\n\r\n$user_id = $_SESSION['user_id'];\r\ninclude '../includes/db.php';\r\n\r\n\r\nfunction fetchAllJobs($pdo, $search = '') {\r\n    try {\r\n        $sql = \"SELECT * FROM lowongan_kerja\";\r\n        if (!empty($search)) {\r\n            $search = '%' . $search . '%';\r\n            $sql .= \" WHERE nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search\";\r\n        }\r\n        $stmt = $pdo->prepare($sql);\r\n        if (!empty($search)) {\r\n            $stmt->execute(['search' => $search]);\r\n        } else {\r\n            $stmt->execute();\r\n        }\r\n        return $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    } catch (PDOException $e) {\r\n        error_log(\"Error: \" . $e->getMessage());\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction fetchMahasiswaDetails($pdo, $user_id) {\r\n    try {\r\n        $sql = \"SELECT prodi_id, keahlian, ijazah, resume, khs_semester_1, khs_semester_2, khs_semester_3, khs_semester_4, khs_semester_5, khs_semester_6, khs_semester_7, khs_semester_8, ipk_semester_1, ipk_semester_2, ipk_semester_3, ipk_semester_4, ipk_semester_5, ipk_semester_6, ipk_semester_7, ipk_semester_8 FROM mahasiswas WHERE user_id = :user_id\";\r\n        $stmt = $pdo->prepare($sql);\r\n        $stmt->execute(['user_id' => $user_id]);\r\n        return $stmt->fetch(PDO::FETCH_ASSOC);\r\n    } catch (PDOException $e) {\r\n        error_log(\"Error: \" . $e->getMessage());\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction fetchJobs($pdo, $search = '') {\r\n    try {\r\n        $sql = \"SELECT * FROM lowongan_kerja\";\r\n        if (!empty($search)) {\r\n            $search = '%' . $search . '%';\r\n            $sql .= \" WHERE nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search\";\r\n            $stmt = $pdo->prepare($sql);\r\n            $stmt->execute(['search' => $search]);\r\n        } else {\r\n            $stmt = $pdo->query($sql);\r\n        }\r\n        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n        return $jobs;\r\n    } catch (PDOException $e) {\r\n        error_log(\"Error: \" . $e->getMessage());\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction fetchFilteredJobs($pdo, $prodi_id, $keahlian, $search = '') {\r\n    try {\r\n        $keahlian = '%' . $keahlian . '%';\r\n        $sql = \"SELECT * FROM lowongan_kerja \r\n                WHERE (JSON_CONTAINS(prodi, JSON_OBJECT('id', :prodi_id)) \r\n                OR keahlian LIKE :keahlian)\";\r\n        if (!empty($search)) {\r\n            $search = '%' . $search . '%';\r\n            $sql .= \" AND (nama_pekerjaan LIKE :search OR posisi LIKE :search OR kualifikasi LIKE :search)\";\r\n        }\r\n        $stmt = $pdo->prepare($sql);\r\n        $params = ['prodi_id' => $prodi_id, 'keahlian' => $keahlian];\r\n        if (!empty($search)) {\r\n            $params['search'] = $search;\r\n        }\r\n        $stmt->execute($params);\r\n        $jobs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n        return $jobs;\r\n    } catch (PDOException $e) {\r\n        error_log(\"Error: \" . $e->getMessage());\r\n        return false;\r\n    }\r\n}\r\n\r\n$search = isset($_POST['search']) ? $_POST['search'] : '';\r\n$mahasiswa = fetchMahasiswaDetails($pdo, $user_id);\r\nif ($mahasiswa) {\r\n    $prodi_id = $mahasiswa['prodi_id'];\r\n    $keahlian = $mahasiswa['keahlian'];\r\n    $jobs = fetchFilteredJobs($pdo, $prodi_id, $keahlian, $search);\r\n} else {\r\n    $jobs = fetchJobs($pdo, $search);\r\n}\r\n\r\n// Determine the number of valid semesters based on IPK\r\n$valid_semesters = 0;\r\nfor ($i = 1; $i <= 8; $i++) {\r\n    if (!empty($mahasiswa['ipk_semester_' . $i])) {\r\n        $valid_semesters = $i;\r\n    }\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Cari Kerja</title>\r\n    <link rel=\"stylesheet\" href=\"../app/plugins/fontawesome-free/css/all.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.dark.min.css\" media=\"screen\">\r\n    <link rel=\"stylesheet\" href=\"../app/dist/css/adminlte.light.min.css\" media=\"screen\">\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700\" rel=\"stylesheet\">\r\n    <style>\r\n    .nav-sidebar .nav-link.active {\r\n        background-color: #343a40 !important;\r\n    }\r\n\r\n    .content-wrapper {\r\n        padding: 20px !important;\r\n    }\r\n\r\n    .content-header {\r\n        padding: 20px 0 !important;\r\n    }\r\n\r\n    .card {\r\n        transition: transform 0.2s;\r\n        margin-bottom: 20px;\r\n    }\r\n\r\n    .card:hover {\r\n        transform: scale(1.05);\r\n    }\r\n\r\n    .search-bar {\r\n        margin-bottom: 20px;\r\n    }\r\n    </style>\r\n</head>\r\n\r\n<body class=\"hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed\">\r\n    <div class=\"wrapper\">\r\n        <?php include 'navbar_mhs.php'; ?>\r\n\r\n        <div class=\"content-wrapper\">\r\n            <div class=\"content-header\">\r\n                <div class=\"container-fluid\">\r\n                    <div class=\"row mb-2\">\r\n                        <div class=\"col-sm-6\">\r\n                            <h1 class=\"m-0\">Cari Lowongan yang Sesuai</h1>\r\n                        </div>\r\n                        <div class=\"col-sm-6\">\r\n                            <ol class=\"breadcrumb float-sm-right\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"#\">Home</a></li>\r\n                                <li class=\"breadcrumb-item active\">Cari Kerja</li>\r\n                            </ol>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <section class=\"content\">\r\n                <div class=\"container-fluid\">\r\n                    <?php if (isset($_SESSION['success_message'])): ?>\r\n                    <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">\r\n                        <?php echo $_SESSION['success_message']; unset($_SESSION['success_message']); ?>\r\n                        <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                        </button>\r\n                    </div>\r\n                    <?php endif; ?>\r\n                    <div class=\"row search-bar\">\r\n                        <div class=\"col-md-12\">\r\n                            <form method=\"POST\" action=\"cari_kerja.php\">\r\n                                <div class=\"input-group\">\r\n                                    <input type=\"text\" class=\"form-control\" name=\"search\" placeholder=\"Search\"\r\n                                        value=\"<?php echo htmlspecialchars($search); ?>\">\r\n                                    <div class=\"input-group-append\">\r\n                                        <button class=\"btn btn-primary\" type=\"submit\"><i\r\n                                                class=\"fas fa-search\"></i></button>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row\">\r\n                        <?php if (!empty($jobs)): ?>\r\n                        <?php foreach ($jobs as $row): ?>\r\n                        <?php\r\n                            // Decode JSON data\r\n                            $prodi = json_decode($row['prodi'], true);\r\n                            $keahlian = json_decode($row['keahlian'], true);\r\n\r\n                            // Cek apakah batas waktu sudah terlewati\r\n                            $batas_waktu = new DateTime($row['batas_waktu']);\r\n                            $current_date = new DateTime();\r\n                            $is_expired = $current_date > $batas_waktu;\r\n\r\n                            // Check if the student has already applied for the job\r\n                            $sql = \"SELECT COUNT(*) FROM lamaran_mahasiswas WHERE lowongan_id = :lowongan_id AND mahasiswa_id = :mahasiswa_id AND status = 'Pending'\";\r\n                            $stmt = $pdo->prepare($sql);\r\n                            $stmt->execute(['lowongan_id' => $row['id'], 'mahasiswa_id' => $user_id]);\r\n                            $has_applied = $stmt->fetchColumn() > 0;\r\n                            ?>\r\n                        <div class=\"col-lg-3 col-md-4 col-sm-6 col-12\">\r\n                            <div class=\"card\">\r\n                                <div class=\"card-body\">\r\n                                    <h5 class=\"card-title\"><?php echo htmlspecialchars($row['nama_pekerjaan']); ?></h5>\r\n                                    <p class=\"card-text\"><strong>Posisi:</strong>\r\n                                        <?php echo htmlspecialchars($row['posisi']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Kualifikasi:</strong>\r\n                                        <?php echo htmlspecialchars($row['kualifikasi']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Program Studi:</strong>\r\n                                        <?php foreach ($prodi as $p) {\r\n                                                echo htmlspecialchars($p['value']) . '<br>';\r\n                                            } ?>\r\n                                    </p>\r\n                                    <p class=\"card-text\"><strong>Keahlian:</strong>\r\n                                        <?php foreach ($keahlian as $k) {\r\n                                                echo htmlspecialchars($k['value']) . '<br>';\r\n                                            } ?>\r\n                                    </p>\r\n                                    <p class=\"card-text\"><strong>Tanggal Posting:</strong>\r\n                                        <?php echo htmlspecialchars($row['tanggal_posting']); ?></p>\r\n                                    <p class=\"card-text\"><strong>Batas Waktu:</strong>\r\n                                        <?php echo htmlspecialchars($row['batas_waktu']); ?></p>\r\n                                    <?php if ($is_expired): ?>\r\n                                    <button class='btn btn-secondary btn-sm' disabled>Lamaran Expired</button>\r\n                                    <?php elseif ($has_applied): ?>\r\n                                    <button class='btn btn-secondary btn-sm' disabled>Menunggu Balasan</button>\r\n                                    <?php else: ?>\r\n                                    <button class='btn btn-success btn-sm' data-toggle='modal' data-target='#modalLamar'\r\n                                        data-id=\"<?php echo $row['id']; ?>\"\r\n                                        data-mahasiswa=\"<?php echo $user_id; ?>\">Lamar</button>\r\n                                    <?php endif; ?>\r\n                                    <button class='btn btn-primary btn-sm' data-toggle='modal'\r\n                                        data-target='#modalDetailPerusahaan'\r\n                                        data-perusahaan-id=\"<?php echo $row['perusahaan_id']; ?>\">Detail\r\n                                        Perusahaan</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <?php endforeach; ?>\r\n                        <?php else: ?>\r\n                        <p>Tidak ada data</p>\r\n                        <?php endif; ?>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Form modal for applying to job -->\r\n    <div class=\"modal fade\" id=\"modalLamar\" tabindex=\"-1\" aria-labelledby=\"modalLamarLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog modal-dialog-centered\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\" id=\"modalLamarLabel\">Lamar Pekerjaan</h5>\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                        <span aria-hidden=\"true\">&times;</span>\r\n                    </button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <form id=\"formLamar\" method=\"POST\" action=\"lamar_kerja.php\">\r\n                        <input type=\"hidden\" name=\"lowongan_id\" id=\"lowongan_id\">\r\n                        <input type=\"hidden\" name=\"mahasiswa_id\" id=\"mahasiswa_id\">\r\n                        <div class=\"form-group\">\r\n                            <label for=\"pesan\">Pesan</label>\r\n                            <textarea class=\"form-control\" name=\"pesan\" id=\"pesan\" rows=\"5\" required></textarea>\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnTranskipIjazah\"\r\n                                onclick=\"insertTranskipIjazah()\">Masukkan Transkip/Ijazah</button>\r\n                            <button type=\"button\" class=\"btn btn-secondary\" id=\"btnCV\" onclick=\"insertCV()\">Masukkan\r\n                                CV</button>\r\n                            <?php for ($i = 1; $i <= $valid_semesters; $i++): ?>\r\n                            <button type=\"button\" class=\"btn btn-secondary khs-btn\" id=\"btnKHS<?= $i ?>\"\r\n                                onclick=\"insertKHS(<?= $i ?>)\">Masukkan KHS Semester <?= $i ?></button>\r\n                            <?php endfor; ?>\r\n                        </div>\r\n                        <input type=\"hidden\" name=\"transkip_ijazah\" id=\"transkip_ijazah\">\r\n                        <input type=\"hidden\" name=\"cv\" id=\"cv\">\r\n                        <input type=\"hidden\" name=\"khs\" id=\"khs\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Kirim Lamaran</button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n    <div class=\"modal fade\" id=\"modalDetailPerusahaan\" tabindex=\"-1\" aria-labelledby=\"modalDetailPerusahaanLabel\"\r\n        aria-hidden=\"true\">\r\n        <div class=\"modal-dialog modal-dialog-centered\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\" id=\"modalDetailPerusahaanLabel\">Detail Perusahaan</h5>\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                        <span aria-hidden=\"true\">&times;</span>\r\n                    </button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <p><strong>Nama Perusahaan:</strong> <span id=\"detailNamaPerusahaan\"></span></p>\r\n                    <p><strong>Alamat Perusahaan:</strong> <span id=\"detailAlamatPerusahaan\"></span></p>\r\n                    <p><strong>Email Perusahaan:</strong> <span id=\"detailEmailPerusahaan\"></span></p>\r\n                    <p><strong>Jenis Perusahaan:</strong> <span id=\"detailJenisPerusahaan\"></span></p>\r\n                    <p><strong>Tahun Didirikan:</strong> <span id=\"detailTahunDidirikan\"></span></p>\r\n                    <p><strong>Pimpinan Perusahaan:</strong> <span id=\"detailPimpinanPerusahaan\"></span></p>\r\n                    <p><strong>Deskripsi Perusahaan:</strong> <span id=\"detailDeskripsiPerusahaan\"></span></p>\r\n                    <p><strong>No Telp:</strong> <span id=\"detailNoTelp\"></span></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"../app/plugins/jquery/jquery.min.js\"></script>\r\n    <script src=\"../app/plugins/bootstrap/js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"../app/dist/js/adminlte.min.js\"></script>\r\n    <script>\r\n    $('#modalLamar').on('show.bs.modal', function(event) {\r\n        var button = $(event.relatedTarget);\r\n        var id = button.data('id');\r\n        var mahasiswa = button.data('mahasiswa');\r\n\r\n        var modal = $(this);\r\n        modal.find('#lowongan_id').val(id);\r\n        modal.find('#mahasiswa_id').val(mahasiswa);\r\n\r\n        // Reset button colors\r\n        $('#btnTranskipIjazah').removeClass('btn-success').addClass('btn-secondary');\r\n        $('#btnCV').removeClass('btn-success').addClass('btn-secondary');\r\n        $('.khs-btn').removeClass('btn-success').addClass('btn-secondary');\r\n\r\n        // Reset hidden inputs\r\n        $('#transkip_ijazah').val('');\r\n        $('#cv').val('');\r\n        $('#khs').val('');\r\n    });\r\n\r\n    $('#modalDetailPerusahaan').on('show.bs.modal', function(event) {\r\n        var button = $(event.relatedTarget);\r\n        var perusahaanId = button.data('perusahaan-id');\r\n\r\n        var modal = $(this);\r\n\r\n        $.ajax({\r\n            url: 'get_perusahaan_detail.php',\r\n            method: 'GET',\r\n            data: {\r\n                user_id: perusahaanId\r\n            },\r\n            success: function(response) {\r\n                var details = JSON.parse(response);\r\n                if (details.error) {\r\n                    modal.find('#detailNamaPerusahaan').text(\"Data tidak ditemukan\");\r\n                    modal.find('#detailAlamatPerusahaan').text(\"\");\r\n                    modal.find('#detailEmailPerusahaan').text(\"\");\r\n                    modal.find('#detailJenisPerusahaan').text(\"\");\r\n                    modal.find('#detailTahunDidirikan').text(\"\");\r\n                    modal.find('#detailPimpinanPerusahaan').text(\"\");\r\n                    modal.find('#detailDeskripsiPerusahaan').text(\"\");\r\n                    modal.find('#detailNoTelp').text(\"\");\r\n                } else {\r\n                    modal.find('#detailNamaPerusahaan').text(details.nama_perusahaan);\r\n                    modal.find('#detailAlamatPerusahaan').text(details.alamat_perusahaan);\r\n                    modal.find('#detailEmailPerusahaan').text(details.email_perusahaan);\r\n                    modal.find('#detailJenisPerusahaan').text(details.nama_jenis);\r\n                    modal.find('#detailTahunDidirikan').text(details.tahun_didirikan);\r\n                    modal.find('#detailPimpinanPerusahaan').text(details.pimpinan_perusahaan);\r\n                    modal.find('#detailDeskripsiPerusahaan').text(details.deskripsi_perusahaan);\r\n                    modal.find('#detailNoTelp').text(details.no_telp);\r\n                }\r\n            },\r\n            error: function(xhr, status, error) {\r\n                console.error(\"Error: \" + error);\r\n            }\r\n        });\r\n    });\r\n\r\n    function insertTranskipIjazah() {\r\n        var transkipIjazah = \"<?php echo $mahasiswa['ijazah']; ?>\";\r\n        document.getElementById('transkip_ijazah').value = transkipIjazah;\r\n        document.getElementById('btnTranskipIjazah').classList.remove('btn-secondary');\r\n        document.getElementById('btnTranskipIjazah').classList.add('btn-success');\r\n        alert(\"Transkip/Ijazah ditambahkan: \" + transkipIjazah);\r\n    }\r\n\r\n    function insertCV() {\r\n        var cv = \"<?php echo $mahasiswa['resume']; ?>\";\r\n        document.getElementById('cv').value = cv;\r\n        document.getElementById('btnCV').classList.remove('btn-secondary');\r\n        document.getElementById('btnCV').classList.add('btn-success');\r\n        alert(\"CV ditambahkan: \" + cv);\r\n    }\r\n\r\n    function insertKHS(semester) {\r\n        var khs = \"\";\r\n        switch (semester) {\r\n            case 1:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_1']; ?>\";\r\n                break;\r\n            case 2:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_2']; ?>\";\r\n                break;\r\n            case 3:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_3']; ?>\";\r\n                break;\r\n            case 4:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_4']; ?>\";\r\n                break;\r\n            case 5:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_5']; ?>\";\r\n                break;\r\n            case 6:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_6']; ?>\";\r\n                break;\r\n            case 7:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_7']; ?>\";\r\n                break;\r\n            case 8:\r\n                khs = \"<?php echo $mahasiswa['khs_semester_8']; ?>\";\r\n                break;\r\n            default:\r\n                alert(\"Semester tidak valid\");\r\n                return;\r\n        }\r\n        document.getElementById('khs').value = khs;\r\n        document.getElementById('btnKHS' + semester).classList.remove('btn-secondary');\r\n        document.getElementById('btnKHS' + semester).classList.add('btn-success');\r\n        alert(\"KHS Semester \" + semester + \" ditambahkan: \" + khs);\r\n    }\r\n    </script>\r\n</body>\r\n\r\n</html>"
        }
    ]
}